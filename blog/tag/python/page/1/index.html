<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    
    <meta id="postList">

    
    <title>
    Fairly One-Dimensional
</title>

    
    <link rel="apple-touch-icon" sizes="57x57" href="/static/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/static/icons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/static/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/static/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/static/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/static/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/static/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/static/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/icons/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/static/icons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/static/icons/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/static/icons/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/static/icons/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/static/icons/manifest.json">
    <link rel="shortcut icon" href="/static/icons/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-TileImage" content="/static/icons/mstile-144x144.png">
    <meta name="msapplication-config" content="/static/icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Abel">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Sans:400,700">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/static/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="/static/style/animations.css"/>
    <link rel="stylesheet" type="text/css" href="/static/style/tooltipster.bundle.css" />
    <link rel='stylesheet' type='text/css' media='screen and (min-device-width: 1101px) and (max-device-width: 2600px)' href='/static/style/style.css' />
    <link rel='stylesheet' type='text/css' media='screen and (min-device-width: 2601px)' href='/static/style/style-ultrawide.css' />
    <link rel='stylesheet' type='text/css' media='screen and (min-device-width: 701px) and (max-device-width: 1100px)' href='/static/style/style-tablet.css' />
    <link rel='stylesheet' type='text/css' media='screen and (max-device-width: 700px)' href='/static/style/style-mobile.css' />


    
    <script type="text/javascript" src="/static/javascript/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" src="/static/javascript/tooltipster.bundle.min.js"></script>
    <script type="text/javascript" src="/static/javascript/main.js"></script>

    
    <script type="text/javascript" src="/static/javascript/utils.js"></script>

    
    <script type="text/javascript">var switchTo5x=true;</script>
    <script type="text/javascript" src='http://w.sharethis.com/button/buttons.js'></script>
    <script type="text/javascript">stLight.options({publisher: "5da51cd4-4e57-428f-9aa9-8b6165d05b3f", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

</head>
<body>

<div class="page-wrap">

    <div class="nameHeader">
        <h1>
    <a href="/blog/page/1" class="headerLink">
        Fairly One-Dimensional
    </a>
</h1>
    </div>

    <div class="container-fluid">
        <div class="row navBar">
            <ul class="navIcon">
                <li class="navAbout">
                    <a href="/about/" class="showTooltip" title="About Me">
                        <img src="/static/images/navigation-icons/about_me.png"
                             class="img-responsive">
                    </a>
                </li>
                <li class="navMLResearch">
                    <a href="/ml_research/" class="showTooltip" title="Deep Learning Research">
                        <div class="dnn_im_container">
                            <img src="/static/images/navigation-icons/dnn_icon-01.png"
                                 class="img-responsive dnn_im dnn_im_1" >
                             <img src="/static/images/navigation-icons/dnn_icon-02.png"
                                class="img-responsive dnn_im dnn_im_2">
                            <img src="/static/images/navigation-icons/dnn_icon-03.png"
                                class="img-responsive dnn_im dnn_im_3">    
                        </div>
                    </a>
                </li>
                <li class="navNeuroResearch">
                    <a href="/neuro_research/" class="showTooltip" title="Neuroscience Research">
                        <img src="/static/images/navigation-icons/brain_icon.png"
                             class="img-responsive">
                    </a>
                </li>
                <li class="navPubs">
                    <a href="/publications/" class="showTooltip" title="CV and Publications">
                        <div class="pub_im_container">
                            <div class="scroll_container">
                                <img src="/static/images/navigation-icons/scroll-02.png"
                                     class="img-responsive scroll_long">
                            </div>
                            <img src="/static/images/navigation-icons/scroll-01.png"
                                 class="img-responsive scroll_short">
                        </div>
                    </a>
                </li>
                <li class="navBlog">
                    <a href="/blog/page/1/" class="showTooltip" title="Blog">
                        <img src="/static/images/navigation-icons/pencil.png"
                             class="img-responsive">
                    </a>
                </li>
                <li class="navContact">
                    <a href="/contact/" class="showTooltip" title="Contact">
                        <img src="/static/images/navigation-icons/paper_airplane.png"
                             class="img-responsive">
                    </a>
                </li>
            </ul>
        </div>
    </div>

    
    

    <div class="container">
        <div class="row completeLeft postList col-md-9 col-sm-12 col-xs-12">

            

                <div class="contentCard">
                    <div class="recentPost">

                        
                        <h2 class="blogPostTitle sectionHeading text-center">
                            <a href="/blog/post/reddit_dataset/">
                                Creating a reddit data set
                            </a>
                        </h2>
                        <h4 class=" blogDate text-center">
                            2015-03-13
                        </h4>

                        
                            <div class="postImage">
                                <img src=/static/blogImages/201503/redditToDatabase.png width=100%></img>
                            </div>
                        

                        
                        <div class="postContent">
                            <p>
                                <p>In preparation for the first set of analyses I'm planning for this blog, I spent some time over the last week preparing a package to create data sets from reddit. The package will collect comments and posts from specified subreddits within a custom date range and save it to a sqlite3 database for later analysis. </p>
<p>To do this, I've used <a href="https://github.com/praw-dev/praw">PRAW</a>, a python wrapper for the Reddit API. PRAW allows you to easily retrieve comments and posts from specific subreddits and users and gracefully handles Reddit's API usage limits. However, finding posts within a specific time range is much trickier.  </p>
<div id="breakStart"></div>

<h2>PRAW/Reddit API Basics</h2>
<p>This isn't intended as a tutorial for PRAW. If you want that, I recommend visiting their <a href="https://praw.readthedocs.org/en/v2.1.20/" title="PRAW documentation">docs</a>. This section will only go through the fundamentals of PRAW necessary to create a data set from reddit. </p>
<p>First, let's import praw and the redditDataset module</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">praw</span>
<span class="kn">import</span> <span class="nn">redditDataset</span>
</code></pre></div>

<p>Next, let's initialize a connection with PRAW as follows: </p>
<div class="codehilite"><pre><span></span><code><span class="err">redditObject = praw.Reddit(user_agent=&#39;get_reddit_dataset&#39;)</span>
</code></pre></div>

<p>We can grab subreddits using <code>getSubreddits</code>. Here, we'll grab /r/funny and /r/gaming</p>
<div class="codehilite"><pre><span></span><code><span class="err">subreddits = redditDataset.getSubreddits(redditObject, [&#39;funny&#39;, &#39;gaming&#39;])</span>
</code></pre></div>

<p>PRAW also has a variety of functions to grab subreddits. One of the most useful is the method <code>get_popular_subreddits</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="err">popularSubreddits = redditObject.get_popular_subreddits(limit=200)</span>
</code></pre></div>

<p>This will return a generator containing the 200 most popular subreddits. PRAW has many other methods to grab specific submissions, comments, users, etc., but these are the only ones you'll need to know to use the module. </p>
<p>Now that we have a reddit object and the subreddits to query, let's make a data set. </p>
<h2>Grabbing a data set from a set of subreddits</h2>
<p>Once you have a generator or list of subreddit objects and your praw object, call <code>createDataset</code> to start downloading comments and posts into a sqlite3 database. The database will be saved in <code>~\Databases\&lt;dbName&gt;db</code>.</p>
<p>Let's grab all the posts from the funny subreddit from March 1, 2015: </p>
<div class="codehilite"><pre><span></span><code><span class="err">funnySubreddit = redditDataset.getSubreddits(redditObject, [&#39;funny&#39;])</span>
<span class="err">redditDataset.createDataset(redditObject, funnySubreddit, startDate=&#39;150301000000&#39;</span>
<span class="err">                            endDate=&#39;150301235959&#39;, dbName=&#39;March_01_2015_funny_posts&#39;</span>
<span class="err">                            fineScale=4)</span>
</code></pre></div>

<p>Basically, you give <code>createDataset</code> the reddit object, the subreddits (in list or generator form), a start and end date, a base name for the database, and a fine scale (which I'll get to in a moment). </p>
<p>For the start and end date, provide a string in the format 'yymmddHHMMSS'. So, in the above example, we're pulling posts between March 1, 2015 at 12:00:00 AM and March 1, 2015 at 11:59:59 PM. </p>
<p>Unfortunately, the reddit API will only provide a list of 1000 posts for any query. What does this mean for us? Well, say we want to get all the posts from 2014. If we request all those posts, we'll only get the 1000 with whatever sort is specified (<code>createDataset</code> uses a 'top' sort). To get around this, <code>createDataset</code> will make many requests in increments of 'fineScale' hours. So, in the example, above, we'll actually make six separate queries for a theoretical maximum of 6,000 posts. Because of the overhead associated with getting posts, we want to set this parameter to be as large as possible while still getting all the data we want. I've found that 8 works well for all but the most frequented subreddits. </p>
<p>And that's it! It'll work to retrieve all the posts within the desired range and the top comments from each post (by default, this is set to 100). One thing to note: because of the reddit API limits, this process is slow. We can only make 30 requests per minute. Currently, we only get the data for one post per request. I think this can be improved (potentially up to 25 posts per request), but I haven't gotten around to it yet.   </p>
<h2>Database structure</h2>
<p>The sql database is pretty simple. It has two tables: <code>submissions</code> and <code>comments</code>. </p>
<p>Each row in <code>submissions</code> represents a single post. The columns contain the <code>postID</code>, <code>postTitle</code>, <code>postBody</code> (text if a self-post, url if a link), <code>postScore</code> (as of when it was downloaded), <code>subredditName</code>, and <code>subredditID</code>. </p>
<p>Each row in <code>comments</code> represents a single comment in a post. The columns contain the <code>commentDate</code>, <code>user</code>, <code>body</code>, <code>comScore</code> (as of when it was downloaded), and the <code>postID</code>. </p>
<h2>How to grab posts within a specified time range</h2>
<p>If you're just interested in using the package, you can skip this part. Figuring out how to grab posts within a time range was a bit of a pain as there's no native support for it in the reddit API or in PRAW. Reddit offers native support for filtering based on a set date range relative to now. So, for example, it's easy to grab posts from the last hour, day, week, month, or year, but challenging to grab posts from the month before last, or even the last month except for today. I spent a long time searching for an alternative with little success.</p>
<p>I eventually figured out that the reddit search engine accepts timestamp queries with the date provided in the unix time format. So, the search query <code>timestamp:1425186000..1425229199</code> will return the 1000 posts sorted however you'd like (new, top, hot, relevance) from March 1, 2015. Importantly, this will not work using the default reddit search engine. You need to add <code>syntax=cloudsearch</code> to the end of the url to enable the native features of <a href="http://aws.amazon.com/cloudsearch/">Amazon CloudSearch</a>, one of which is timestamps. </p>
<h2>Summary</h2>
<p>You can check out the code for this project <a href="https://github.com/arimorcos/getRedditDataset">here</a>. I've also collected a data set of almost all the posts along with their top 100 comments from the top 200 subreddits from March 2-8, 2015. You can get this database <a href="ftp://209.6.60.59/March2-8_Top200.db">here</a>. </p>
<p>Now that I have the data, it's time to start asking questions!  </p>
<div id="breakEnd"></div>
                            </p>
                        </div>

                        <div class="row blogSummaryBottom">

                            
                            <a class="continueReading col-md-12 col-xs-12"
                               href="/blog/post/reddit_dataset/">
                                Continue Reading &#8594;
                            </a>

                            
                            <a class="disqus-comment-count commentCount col-md-3 col-xs-5"
                               data-disqus-identifier="Creating a reddit data set"
                               href="/blog/post/reddit_dataset/#disqus_thread">
                            </a>

                            <div class="bottomTagList col-md-5 col-xs-12">
                                <p>
                                    Tagged with:
                                    
                                        
                                            <a href="/blog/tag/reddit/page/1/">reddit,</a>
                                        
                                    
                                        
                                            <a href="/blog/tag/praw/page/1/">praw,</a>
                                        
                                    
                                        
                                            <a href="/blog/tag/dataSet/page/1/">dataSet,</a>
                                        
                                    
                                        
                                            <a href="/blog/tag/sql/page/1/">sql,</a>
                                        
                                    
                                        
                                            <a href="/blog/tag/python/page/1/">python,</a>
                                        
                                    
                                        
                                            <a href="/blog/tag/api/page/1/">api</a>
                                        
                                    
                                </p>
                            </div>

                            <span class="shareButtons pull-right col-md-4 col-xs-12">
                                <span class='st_twitter_large' displayText='Tweet'></span>
                                <span class='st_reddit_large' displayText='Reddit'></span>
                                <span class='st_facebook_large' displayText='Facebook'></span>
                                <span class='st_googleplus_large' displayText='Google +'></span>
                                <span class='st_email_large' displayText='Email'></span>
                            </span>



                        </div>
                    </div>
                </div>

            

                <div class="contentCard">
                    <div class="recentPost">

                        
                        <h2 class="blogPostTitle sectionHeading text-center">
                            <a href="/blog/post/hello_world/">
                                Hello World!
                            </a>
                        </h2>
                        <h4 class=" blogDate text-center">
                            2015-02-24
                        </h4>

                        

                        
                        <div class="postContent">
                            <p>
                                <p>Hello internet! Welcome to Fairly One-Dimensional, my blog about finding patterns in complex datasets. My goal is to post a new analysis of some freely available dataset every week or two (assuming my <a href="http://www.arimorcos.com/research/">research</a> allows me the time). These posts will usually be motivated by questions about the data itself, but I'll probably also post analyses intentionally constructed to make use of various techniques in machine learning I want to try out. As I'm a huge baseball fan, I imagine a fair number of posts will focus on sabermetrics as well. In making this blog, I was inspired by a bunch of people doing awesome analyses, especially <a href="http://fivethirtyeight.com/">FiveThirtyEight</a>, <a href="http://www.randalolson.com/blog/">Randal Olson</a>,  <a href="http://www.baseballprospectus.com">Baseball Prospectus</a>, and <a href="http://www.fangraphs.com">Fangraphs</a>.</p>
<div id="breakStart"></div>

<p>As for the website itself, it's built with a <a href="http://flask.pocoo.org/">Flask</a> back end and <a href="http://getbootstrap.com/">Twitter Bootstrap 3</a> for the front end. I had never built a website before, and it's been a lot of fun learning about the amazing resources people have come up with. The <a href="https://github.com/arimorcos/arimorcos.com">source</a> is available on Github. </p>
<div id="breakEnd"></div>
                            </p>
                        </div>

                        <div class="row blogSummaryBottom">

                            
                            <a class="continueReading col-md-12 col-xs-12"
                               href="/blog/post/hello_world/">
                                Continue Reading &#8594;
                            </a>

                            
                            <a class="disqus-comment-count commentCount col-md-3 col-xs-5"
                               data-disqus-identifier="Hello World!"
                               href="/blog/post/hello_world/#disqus_thread">
                            </a>

                            <div class="bottomTagList col-md-5 col-xs-12">
                                <p>
                                    Tagged with:
                                    
                                        
                                            <a href="/blog/tag/python/page/1/">python,</a>
                                        
                                    
                                        
                                            <a href="/blog/tag/flask/page/1/">flask,</a>
                                        
                                    
                                        
                                            <a href="/blog/tag/sabermetrics/page/1/">sabermetrics</a>
                                        
                                    
                                </p>
                            </div>

                            <span class="shareButtons pull-right col-md-4 col-xs-12">
                                <span class='st_twitter_large' displayText='Tweet'></span>
                                <span class='st_reddit_large' displayText='Reddit'></span>
                                <span class='st_facebook_large' displayText='Facebook'></span>
                                <span class='st_googleplus_large' displayText='Google +'></span>
                                <span class='st_email_large' displayText='Email'></span>
                            </span>



                        </div>
                    </div>
                </div>

            

            
            

        </div>

        
        <div class="contentCard rightBlogBrowser pull-right
                    col-md-3 col-sm-3">

            <h2 class="text-center">Recent Posts</h2>
            
                <p>
                    <a href="/blog/post/mining_google_search_part_1/"
                       class="recentPostText">
                        Mining my google search history for clues, Part I
                    </a>
                </p>
            
                <p>
                    <a href="/blog/post/sentiment_movie_taglines/"
                       class="recentPostText">
                        Sentiment analysis of movie taglines
                    </a>
                </p>
            
                <p>
                    <a href="/blog/post/clustering_reddit_common_word/"
                       class="recentPostText">
                        Clustering subreddits by common word usage
                    </a>
                </p>
            
                <p>
                    <a href="/blog/post/reddit_dataset/"
                       class="recentPostText">
                        Creating a reddit data set
                    </a>
                </p>
            
                <p>
                    <a href="/blog/post/hello_world/"
                       class="recentPostText">
                        Hello World!
                    </a>
                </p>
            
        </div>

        
        <div class="contentCard rightBlogBrowser pull-right tagCloud
                    col-md-3 col-sm-3">
            <h2 class="text-center">Common Topics</h2>
            

                
                    <a href="/blog/tag/affinityPropagation/page/1/"
                       class="tag1">
                        affinityPropagation,
                    </a>
                
            

                
                    <a href="/blog/tag/api/page/1/"
                       class="tag1">
                        api,
                    </a>
                
            

                
                    <a href="/blog/tag/clustering/page/1/"
                       class="tag1">
                        clustering,
                    </a>
                
            

                
                    <a href="/blog/tag/dataSet/page/1/"
                       class="tag1">
                        dataSet,
                    </a>
                
            

                
                    <a href="/blog/tag/euclideanDistance/page/1/"
                       class="tag1">
                        euclideanDistance,
                    </a>
                
            

                
                    <a href="/blog/tag/flask/page/1/"
                       class="tag1">
                        flask,
                    </a>
                
            

                
                    <a href="/blog/tag/google/page/1/"
                       class="tag1">
                        google,
                    </a>
                
            

                
                    <a href="/blog/tag/imdb/page/1/"
                       class="tag1">
                        imdb,
                    </a>
                
            

                
                    <a href="/blog/tag/movies/page/1/"
                       class="tag1">
                        movies,
                    </a>
                
            

                
                    <a href="/blog/tag/nltk/page/1/"
                       class="tag1">
                        nltk,
                    </a>
                
            

                
                    <a href="/blog/tag/pca/page/1/"
                       class="tag1">
                        pca,
                    </a>
                
            

                
                    <a href="/blog/tag/praw/page/1/"
                       class="tag1">
                        praw,
                    </a>
                
            

                
                    <a href="/blog/tag/python/page/1/"
                       class="tag2">
                        python,
                    </a>
                
            

                
                    <a href="/blog/tag/queries/page/1/"
                       class="tag1">
                        queries,
                    </a>
                
            

                
                    <a href="/blog/tag/reddit/page/1/"
                       class="tag2">
                        reddit,
                    </a>
                
            

                
                    <a href="/blog/tag/sabermetrics/page/1/"
                       class="tag1">
                        sabermetrics,
                    </a>
                
            

                
                    <a href="/blog/tag/searchHistory/page/1/"
                       class="tag1">
                        searchHistory,
                    </a>
                
            

                
                    <a href="/blog/tag/sentimentAnalysis/page/1/"
                       class="tag1">
                        sentimentAnalysis,
                    </a>
                
            

                
                    <a href="/blog/tag/sql/page/1/"
                       class="tag1">
                        sql,
                    </a>
                
            

                
                    <a href="/blog/tag/taglines/page/1/"
                       class="tag1">
                        taglines
                    </a>
                
            
        </div>

        
        <div class="contentCard rightBlogBrowser pull-right rssSubscribe
                    col-md-3 col-sm-3">
            <p>
                <img src="/static/images/navigation-icons/rss_icon.png"
                     href="/static/rss/fairlyOneDimensionalFeed.xml">
                <a href="/static/rss/fairlyOneDimensionalFeed.xml">
                    Subscribe to RSS Feed
                </a>
            </p>
        </div>
    </div>

    
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'arimorcos'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>




</div>


<footer class="siteFooter container">
    <p class="copyrightText text-center">
        &copy; <script language="javascript" type="text/javascript">
        var today = new Date()
        var year = today.getFullYear()
        document.write(year)
    </script> Ari Morcos All rights reserved
    </p>
</footer>


<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60029364-1', 'auto');
    ga('send', 'pageview');

</script>

</body>
</html>